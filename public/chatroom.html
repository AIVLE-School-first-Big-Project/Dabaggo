<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dabaggo</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet" type="text/css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="main.css" rel="stylesheet">
</head>

<!-- 글꼴입니다 -->
<style>
  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  p,
  a,
  button,
  span,
  input,
  li {
      font-family: 'Pretendard' !important;
  }
</style>
<!-- 글꼴입니다 -->


<body>
  <!-- ------------------------------------------------------------------- -->
  <!-- 앱 관련 중요 사항 -->
  <!-- 앱 관련 중요 사항 -->


  <!-- 건들기전 꼭 확인하거나 백업하기 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-database.js"></script> <!-- 중요 -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  


  <!-- 앱 관련 중요 사항 -->
  <!-- 앱 관련 중요 사항 -->
  <!-- 건들지 말기 이진호 firebase 주소임-->
  <script>
     const firebaseConfig = {
      apiKey: "AIzaSyByqReAs09m9FkSMWycfwfAHbIz61qHhvw",
      authDomain: "carot-4cbc3.firebaseapp.com",
      projectId: "carot-4cbc3",
      storageBucket: "carot-4cbc3.appspot.com",
      messagingSenderId: "817108142096",
      appId: "1:817108142096:web:dd9b8da84d2cea92cae295",
      measurementId: "G-WX0DB9KDYR"
      };
      firebase.initializeApp(firebaseConfig) ;
  </script>
  <!-- 앱 관련 중요 사항 -->
  <!-- 앱 관련 중요 사항 -->
  <!-- ------------------------------------------------------------------- -->

























  <!-- 상단 네비게이션 바 -->
  <!-- 상단 네비게이션 바 -->
  <iframe
  src="change.html" 
  onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"
  >
  </iframe>
  <!-- 상단 네비게이션 바 -->
  <!-- 상단 네비게이션 바 -->






  <!-- 방비번입력모달 -->
  <!-- 방비번입력모달 -->

  <div class="modal2 fade" id="staticBackdrop3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-body">
          <!-- 로그인 모달 -->

          <div class="card-body">



            <div class="text-center">
              <h5>방 입장하기</h5>
            </div>
            <br>


            <!-- 모달 로그인 인풋박스 -->
            <div class="input-group flex-nowrap mt-4">
              <span class="input-group-text" ><i class="bi bi-key-fill" style="font-size: 2rem; color: cornflowerblue;"></i></span>
              <input placeholder="비밀번호를 입력해주세요" id="room_password_input" class="form-control">
            </div>

            <!-- 모달 로그인 버튼 -->
            <div class="d-grid gap-2 col-11 mx-auto">
        
              <a id='enter_room' class="btn btn-lg btn-jinho btn-block mt-5">들어가기</a>
              <!-- <a id="naverIdLogin" class="btn btn-lg btn-jinho btn-block mt-5">네이버 완료</a> -->
              


            </div>


          </div>


        </div>

      </div>
    </div>
  </div>
  <!-- 방비번입력모달 -->
  <!-- 방비번입력모달 -->




  <script>

    function enterkey() {
      if (window.event.keyCode == 13) {
        $('#chat_button').click()

        $('html,body').animate({scrollTop: document.body.scrollHeight},"fast");

        setTimeout(function(){
                  
        document.getElementById('input_message').value =''
        },300)


    }}
  </script>






  <script>
    function promiseTest(){
      return new Promise((resolve, reject) => {
          fetch("http://127.0.0.1:5200/kor_to_eng", {
              method: 'POST'
          })
        .then((response) => response.text())
        .then(data => resolve(data));
       
      })}
    
    
    async function test(){
      let result = await promiseTest();
      var test=result
      console.log(test)
      document.getElementById('eng').innerText = test;
      var eng = document.getElementById('eng').innerText
      $('#input_message').attr('value',eng)
      setTimeout(function(){
        
        $('#chat_button').click();


        },1000)

          

    }

</script>


<script>
  function promiseTest2(){
    return new Promise((resolve, reject) => {
        fetch("http://127.0.0.1:5200/eng_to_kor", {
            method: 'POST'
        })
      .then((response) => response.text())
      .then(data => resolve(data));
     
    })}
  
  
  async function test2(){
    let result = await promiseTest2();
    var test=result
    console.log(test)
    document.getElementById('kor').innerText = test;
    var kor = document.getElementById('kor').innerText
    $('#input_message').attr('value',kor)

    setTimeout(function(){
        
        $('#chat_button').click();


        },1000)

  }

</script>




  <!-- 바디 내용 -->
  <!-- 바디 내용 -->
  <!-- mb가 틈사이를 조정해줌 -->
  <header class="py-5 bg-light border-top mb-0"> 

    <div class="container"  style='min-height:800px;'>
      <div class="container row align-items-start chatroom_content" id="temp2">

     

        
        </div>
        
      


        
        <div class="input-group mb-3">
          <input type="text" maxlength="60" id="input_message" onkeyup="enterkey()" class="form-control" style="line-height: 2.5;" placeholder="내용을 입력하세요" aria-describedby="button-addon2">
          <button class="btn btn-outline-secondary" type="button" id="chat_button">&nbsp;&nbsp;보내기&nbsp;&nbsp;</button>
        
        </div>
        <br>
        

        <div>
          <button style='font-size: 16px;' type="button" class="btn btn-lg btn-jinho btn-block" id="mic"><i id='mic_icon'class="bi bi-mic"></i>&nbsp;한국어 녹음</button>
          <button style='font-size: 16px;' type="button" class="btn btn-lg btn-jinho btn-block" id="krtoeng" value="한국어 --> 영어">한국어 <i class="bi bi-arrow-right"></i> 영어</button>
          <button style='font-size: 16px;' type="button"class="btn btn-lg btn-warning btn-block" id="test" value="한국어 --> 영어">자체 번역</button>
          <button style='font-size: 16px;' type="button" class="btn btn-lg btn-danger btn-block" id="mic2"><i class="bi bi-mic"></i>&nbsp;English REC</button>
          <button style='font-size: 16px;' type="button"class="btn btn-lg btn-danger btn-block" id="engtokr" value="영어 --> 한국어">ENG <i class="bi bi-arrow-right"></i> KOR</button>
          <button style='font-size: 16px;' id='del' class="btn btn-lg btn-info btn-block">채팅초기화</button>
          <button style='font-size: 16px;' onclick="location.href='service.html'" id='del' class="btn btn-lg btn-dark btn-block">대기실</button>

          <p id="eng" class='hide'></p>
          <p id="kor" class='hide'></p>
        </div>

        <script>
          function Buttontoggle() {
            var t = document.getElementById("myButton");
            if(t.value=="한국어 --> 영어"){
              t.value="영어 --> 한국어";
              test();
              }
            else if(t.value=="영어 --> 한국어"){
              t.value="한국어 --> 영어";
              test2();
            }
          }

        </script>






    </div>

  </header>
  <!-- 바디 내용 -->
  <!-- 바디 내용 -->




 




























  <!-- Modal -->
  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">

          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- 로그인 모달 -->

          <div class="card-body">



            <div class="text-center">
              <h5>로고박기</h5>
            </div>
            <br>


            <!-- 모달 로그인 인풋박스 -->
            <div class="input-group flex-nowrap mt-4">
              <span class="input-group-text" ><i class="bi bi-envelope" style="font-size: 2rem; color: cornflowerblue;"></i></span>
              <input placeholder="이메일을 입력해주세요" type="email" id="login_email" class="form-control">
            </div>
            
            <div class="input-group flex-nowrap mt-4">
              <span class="input-group-text" ><i class="bi bi-key-fill" style="font-size: 2rem; color: cornflowerblue;"></i></span>
              <input placeholder="비밀번호를 입력해주세요" type="password" id="login_password" class="form-control">
            </div>

            <!-- 모달 로그인 버튼 -->
            <div class="d-grid gap-2 col-11 mx-auto">
        
              <a id="login_button" class="btn btn-lg btn-jinho btn-block mt-5">로그인</a>
              <!-- <a id="naverIdLogin" class="btn btn-lg btn-jinho btn-block mt-5">네이버 완료</a> -->
              
              <div class="mx-auto mt-4">
                <h6>아직 계정이 없으신가요?<a onclick="location.href='register_copy.html'" type="button"
                    class="link-primary mx-3">회원가입</a></h6>
              </div>

            </div>


          </div>


        </div>

      </div>
    </div>
  </div>
  <!-- Modal -->
  <!-- Modal -->

  




























  






















































  <!-- 채널톡 -->
  <!-- 채널톡 -->
  <!-- Channel Plugin Scripts -->
  <script>
    (function() {
      var w = window;
      if (w.ChannelIO) {
        return (window.console.error || window.console.log || function(){})('ChannelIO script included twice.');
      }
      var ch = function() {
        ch.c(arguments);
      };
      ch.q = [];
      ch.c = function(args) {
        ch.q.push(args);
      };
      w.ChannelIO = ch;
      function l() {
        if (w.ChannelIOInitialized) {
          return;
        }
        w.ChannelIOInitialized = true;
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = 'https://cdn.channel.io/plugin/ch-plugin-web.js';
        s.charset = 'UTF-8';
        var x = document.getElementsByTagName('script')[0];
        x.parentNode.insertBefore(s, x);
      }
      if (document.readyState === 'complete') {
        l();
      } else if (window.attachEvent) {
        window.attachEvent('onload', l);
      } else {
        window.addEventListener('DOMContentLoaded', l, false);
        window.addEventListener('load', l, false);
      }
    })();
    ChannelIO('boot', {
      "pluginKey": "7b8044b6-5e6c-4192-aa2b-b33727cced2b"
    });
  </script>
  <!-- End Channel Plugin -->
  <!-- 채널톡 -->
  <!-- 채널톡 -->












































  <!-- 일반 스크립트 -->
  <!-- 일반 스크립트 -->
  <!-- 일반 스크립트 -->
  <!-- 일반 스크립트 -->
  <!-- 일반 스크립트 -->
  <!-- ↓↓↓↓↓↓↓↓↓↓↓↓ -->



 









  
  <!-- 파이어 베이스  -->
  <!-- 파이어 베이스  -->
  <!-- 파이어 베이스  -->
  <!-- ↓↓↓↓↓↓↓↓↓↓↓↓ -->




  <!-- 로그아웃 구현 -->
  <!-- 로그아웃 구현 -->
  <script>
  $('#logout_button').click(function() {
    firebase.auth().signOut();
    document.getElementById('login_nav').className = 'nav-link me-lg-0'

    alert('로그아웃이 완료되었습니다!')

    console.log('로그아웃 완료')
    
      setTimeout(function(){

        location.href="index.html"

      },500);
  })

  </script>
  <!-- 로그아웃 구현 -->
  <!-- 로그아웃 구현 -->


































  <!-- 로그인 구현 -->
  <!-- 로그인 구현 -->
  <script>

    // 기본으로 깔고 감
    const db = firebase.firestore();
    const storage = firebase.storage();
    // ----------------------------------
    
    $('#login_button').click(function () {
      var 이메일 = $('#login_email').val();
      var 패스워드 = $('#login_password').val();

      firebase.auth().signInWithEmailAndPassword(이메일, 패스워드).then((result) => {
        var 최근로그인 ={
            recent_login_date : new Date(), 
        }
      
        db.collection('user').doc(result.user.uid).update(최근로그인);
        alert('로그인 성공')

        setTimeout(function(){
          firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);
        },1000);

        setTimeout(function(){
          location.href="index.html"
      },1000);


      })
    })

  </script>
  <!-- 로그인 구현 -->
  <!-- 로그인 구현 -->
  

  <!-- 로그인 유지 구현 -->
  <!-- 로그인 유지 구현 -->
  <script>

    $('#login_button').click(function () {
    var 이메일 = $('#login_email').val();
    var 패스워드 = $('#login_password').val();


    firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)
    .then(function() {
      // Existing and future Auth states are now persisted in the current
      // session only. Closing the window would clear any existing state even
      // if a user forgets to sign out.
      // ...
      // New sign-in will be persisted with session persistence.
      return firebase.auth().signInWithEmailAndPassword(이메일, 패스워드);
    })
    .catch(function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
    });

  })
  </script>
  <!-- 로그인 유지 구현 -->
  <!-- 로그인 유지 구현 -->



























  <!-- 로그인 상태에 따라 변경됨 if문 = 로그인중, else문 = 로그인중이 아니면 -->
  <!-- 로그인 상태에 따라 변경됨 if문 = 로그인중, else문 = 로그인중이 아니면 -->
  <script>
    firebase.auth().onAuthStateChanged((user)=>{
      if (user) { 
      document.getElementById('login_nav').className = 'hide'
      document.getElementById('logout_button').className = 'nav-link me-lg-0'
      localStorage.setItem('user',JSON.stringify(user))  
  
        console.log(user.email)
      }
      else {
        document.getElementById('logout_button').className = 'hide'
        localStorage.removeItem('user',JSON.stringify(user))
      }
    })
    </script>
    <!-- 로그인 상태에 따라 변경됨 if문 = 로그인중, else문 = 로그인중이 아니면 -->
    <!-- 로그인 상태에 따라 변경됨 if문 = 로그인중, else문 = 로그인중이 아니면 -->
  
    
  <script>

  </script>





    <script>
    
      $('#chat_button').click(function() {
        var 내용 = document.getElementById('input_message').value;
        var 쿼리스트링 = new URLSearchParams(window.location.search);
        var 시간 = new Date(firebase.firestore.Timestamp.now().seconds*1000).toLocaleString();

  
          var 유저정보 = localStorage.getItem('user');
          var 유저이름 = JSON.parse(유저정보).displayName;
          var 유저UID = JSON.parse(유저정보).uid;
  
          var 넣을거 = {
            내용 : 내용,
            시간 : 시간,
            이름 : 유저이름,
            uid : 유저UID,
            방uid : 쿼리스트링.get('id')
          }
  
          db.collection('chat').doc(쿼리스트링.get('id')).collection('채팅').doc().set(넣을거);
          

          setTimeout(function(){
          document.getElementById('input_message').value =''
          },700)
  
          $('html,body').animate({scrollTop: document.body.scrollHeight},"fast");
  
    })

  
  
   
      </script>














    <!-- 채팅 보이기 구현 -->
    <!-- 채팅 보이기 구현 -->
    <script>
      var 쿼리스트링 = new URLSearchParams(window.location.search);
      var 유저정보 = localStorage.getItem('user');
      var 유저UID = JSON.parse(유저정보).uid;


      db.collection('chat').doc(쿼리스트링.get('id')).collection('채팅').orderBy("시간", "asc").onSnapshot((결과) => {
        $('#temp2').html('');
        결과.forEach((doc) => {
          

          if( doc.data().uid == 유저UID){

          var 템플릿 = `
              <div style='text-align:right' class='mychat_txt'>
              <p><i class="bi bi-person-fill">&nbsp;</i>${doc.data().이름}</p>
              <p style='font-size:18px'>${doc.data().내용}</p>
              <p style='font-size:12px'>${doc.data().시간}</p>
              <div>
              <hr>
              `
          $('#temp2').append(템플릿);
        }

        
        else{
          var 템플릿 = `
          <div class='otherchat_txt'>
          <p><i class="bi bi-person-fill">&nbsp;</i>${doc.data().이름}</p>
          <p style='font-size:18px'>${doc.data().내용}</p>
          <p style='font-size:12px'>${doc.data().시간}</p>
          </div>
          <hr>`
         $('#temp2').append(템플릿);
        }

        })
      })
    </script>
    <!-- 채팅 보이기 구현 -->
    <!-- 채팅 보이기 구현 -->





    <!-- 비번이 쿼리랑 같으면 활성화 -->
    <!-- 비번이 쿼리랑 같으면 활성화 -->
    <script>

      setInterval(function check(){



      var 쿼리스트링 = new URLSearchParams(window.location.search);
      db.collection('chat').where('uid','==',쿼리스트링.get('id')).get().then((결과)=>{
        결과.forEach((doc)=>{
          var p1 = document.getElementById('room_password_input').value;
          if (doc.data().방비번 == p1){
            document.getElementById('enter_room').className = 'btn btn-lg btn-jinho btn-block mt-5'
          }
          else{
              document.getElementById('enter_room').className = 'btn btn-lg btn-jinho btn-block mt-5 disabled'
          }
        


        })
      })
    })

    
    </script> 
    <!-- 비번이 쿼리랑 같으면 활성화 -->
    <!-- 비번이 쿼리랑 같으면 활성화 -->



    <!--방 비번 입력 모달창 생성-->
    <!--방 비번 입력 모달창 생성-->
    <script>
      window.onload = function() {
        $('#staticBackdrop3').modal('show')
      }
    </script>

    
    <script>
      $('#enter_room').click(function(){

        $('#staticBackdrop3').modal('hide')
      })
    </script>
    <!--방 비번 입력 모달창 생성-->
    <!--방 비번 입력 모달창 생성-->



    
  <!-- 채팅삭제 -->
  <!-- 채팅삭제 -->
  <script>
    $('#del').on('click',function(){


      var result =  window.confirm('채팅을 초기화 하시겠습니까?');


      if(result == true){

      var 쿼리스트링 = new URLSearchParams(window.location.search);
      var 유저정보 = localStorage.getItem('user');
      var 유저UID = JSON.parse(유저정보).uid;
      db.collection("chat").doc(쿼리스트링.get('id')).collection('채팅').where('방uid', '==', 쿼리스트링.get('id')).onSnapshot((결과)=>{
        결과.forEach((doc)=>{
          console.log(doc.data().uid)
          doc.ref.delete()


          setTimeout(function(){
    
          location.reload();

          },500);

        })

      })
      }

    })

  </script>
  <!-- 채팅삭제 -->
  <!-- 채팅삭제 -->









  <script>
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    $('#mic').click(function(){
    let recognition = new SpeechRecognition();
    recognition.interimResults = true;
    recognition.lang = 'ko-KR';

    recognition.start();
    recognition.onresult = function(e) {
      let texts = Array.from(e.results)
              .map(results => results[0].transcript).join("");
      console.log(texts);
      document.getElementById('input_message').value = texts
    }
})



      

  </script>


  <script>
    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  $('#mic2').click(function(){

  let recognition = new SpeechRecognition();
  recognition.interimResults = true;
  recognition.lang = 'en-us';

  recognition.start();
  recognition.onresult = function(e) {
  let texts = Array.from(e.results)
          .map(results => results[0].transcript).join("");
  console.log(texts);
  document.getElementById('input_message').value = texts
  }
  })





</script>






<script>
  $('#krtoeng').click(()=>{
    var form = document.getElementById('input_message').value;
    $.post('https://aivle.run.goorm.io/text', {'key' : 'aivle', 'text' : form}).done(function(data){
      document.getElementById('input_message').value = data;



  }).then(()=>{
    setTimeout(function(){
    $('#chat_button').click();
    },300)

    setTimeout(function(){
    document.getElementById('input_message').value =''
    },300)
        
  })})

</script>

<script>
  $('#test').click(()=>{
    var form = document.getElementById('input_message').value;
    $.post('http://222.118.46.123/text', {'key' : 'aivle', 'text' : form}).done(function(data){
      document.getElementById('input_message').value = data;



  }).then(()=>{
    setTimeout(function(){
    $('#chat_button').click();
    },300)

    setTimeout(function(){
    document.getElementById('input_message').value =''
    },300)
        
  })})

</script>





<script>
  $('#engtokr').click(()=>{
    var form = document.getElementById('input_message').value;
    $.post('https://aivle.run.goorm.io/eng_to_kor', {'key' : 'aivle', 'text' : form}).done(function(data){
      document.getElementById('input_message').value = data;


  }).then(()=>{
    setTimeout(function(){
    $('#chat_button').click();
    },300)


    setTimeout(function(){
    document.getElementById('input_message').value =''
    },300)
    
  })})

</script>


































</body>



<!-- <footer class="bg-black text-center py-5">
  <div class="container px-5">
      <div class="text-white-50 small">
          <div class="mb-2">&copy; footer임 아직 아무것도 안씀</div>
          <a href="#!">충남충북</a>
          <span class="mx-1">&middot;</span>
          <a href="#!">짱짱맨</a>
          <span class="mx-1">&middot;</span>
          <a href="#!">FAQ</a>
      </div>
  </div>
</footer> -->



</html>